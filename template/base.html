{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title></title>

  <link href='https://ui.aiursoft.com/dist/AiurCore.min.css' rel='stylesheet' />
  <link href='https://ui.aiursoft.com/dist/AiurMarket.min.css' rel='stylesheet' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Poppins:400,500,600,700|Roboto:400,500" rel="stylesheet"/>
  <link rel='stylesheet' href='https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css'>
  <link href="https://cdn.materialdesignicons.com/3.0.39/css/materialdesignicons.min.css" rel="stylesheet" />

  <!-- PLUGINS CSS STYLE -->
  <link href="{% static 'plugins/toaster/toastr.min.css' %}" rel="stylesheet" />
  <link href="{% static 'plugins/nprogress/nprogress.css' %}" rel="stylesheet" />
  <link href="{% static 'plugins/flag-icons/css/flag-icon.min.css' %}" rel="stylesheet"/>
  <link href="{% static 'plugins/jvectormap/jquery-jvectormap-2.0.3.css' %}" rel="stylesheet" />
  <link href="{% static 'plugins/ladda/ladda.min.css' %}" rel="stylesheet" />
  <link href="{% static 'plugins/select2/css/select2.min.css' %}" rel="stylesheet" />
  <link href="{% static 'plugins/daterangepicker/daterangepicker.css' %}" rel="stylesheet" />
  <link href="{% static 'css/tResults.css' %}" rel="stylesheet" />

  <!-- SLEEK CSS -->
  <link id="sleek-css" rel="stylesheet" href="{% static 'css/sleek.css' %}" />
  <link id="sleek-css" rel="stylesheet" href="{% static 'css/style.css' %}" />

  {% block head %}

    {% endblock %}
  

  <!-- FAVICON -->

  <!--
    HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
  -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script src="{% static 'plugins/nprogress/nprogress.js' %}"></script>
</head>


  <body class="sidebar-fixed sidebar-dark header-light header-fixed" id="body">
    <script>
      NProgress.configure({ showSpinner: false });
      NProgress.start();
    </script>

    <div class="mobile-sticky-body-overlay"></div>

    <div class="wrapper">
      
              <!--
          ====================================
          ——— LEFT SIDEBAR WITH FOOTER
          =====================================
        -->
        <aside class="left-sidebar bg-sidebar">
          <div id="sidebar" class="sidebar sidebar-with-footer">
            <!-- Aplication Brand -->
            <div class="app-brand">
              <a href="#">
                <!-- <img src="{% static 'img/WisoTechLogo.png' %}" alt=""> -->
              </a>
            </div>
            <!-- begin sidebar scrollbar -->
            <div class="sidebar-scrollbar">

              <!-- sidebar menu -->
              <ul class="nav sidebar-inner" id="sidebar-menu">
                

                
                  <li  class="has-sub active expand" >
                    <a class="sidenav-item-link" href="javascript:void(0)" data-toggle="collapse" data-target="#dashboard"
                      aria-expanded="false" aria-controls="dashboard">
                      <i class="mdi mdi-view-dashboard-outline"></i>

                      <span class="nav-text">Dashboard</span> <b class="caret"></b>
                    </a>
                    <ul  class="collapse show"  id="dashboard"
                      data-parent="#sidebar-menu">
                      <div class="sub-menu">
                        
                        
                          
                            <li  class="active" >
                              <a class="sidenav-item-link" href="/textminer">
                                <span class="nav-text">Pdf Miner</span>
                                
                              </a>
                            </li>
                          
                      
                        
                          
                            <!-- <li >
                              <a class="sidenav-item-link" href="/documents">
                                <span class="nav-text">Checked Documents</span> -->
                                
                               <!-- <span class="badge badge-success">new</span>-->
                                
                              <!-- </a>
                            </li> -->


                            <li >
                              <a class="sidenav-item-link" href="/mcheck">
                                <span class="nav-text">Manual check</span>
                                
                                <!-- <span class="badge badge-success">new</span>-->
                                
                              </a>
                            </li>
                        
                      </div>
                    </ul>
                  </li>
                

              </ul>
            </div>

            <hr class="separator" />

            
          </div>
        </aside>

      
       
      <div class="page-wrapper">
                  <!-- Header -->
          <header class="main-header " id="header">
            <nav class="navbar navbar-static-top navbar-expand-lg">
              <!-- Sidebar toggle button -->
              <button id="sidebar-toggler" class="sidebar-toggle">
                <span class="sr-only">Toggle navigation</span>
              </button>
              <!-- search form -->
              <div class="search-form d-none d-lg-inline-block">
                <div class="input-group">
                  <button type="button" name="search" id="search-btn" class="btn btn-flat">
                    <i class="mdi mdi-magnify"></i>
                  </button>
                  <input type="text" name="query" id="search-input" class="form-control" placeholder=" 'Search here"
                    autofocus autocomplete="off" />
                </div>
                <div id="search-results-container">
                  <ul id="search-results"></ul>
                </div>
              </div>

              <div class="navbar-right ">
                <ul class="nav navbar-nav">
                  <!-- Github Link Button -->
                  <!--<li class="github-link mr-3">
                    <a class="btn btn-outline-secondary btn-sm" href="https://github.com/tafcoder/sleek-dashboard" target="_blank">
                      <span class="d-none d-md-inline-block mr-2">Source Code</span>
                      <i class="mdi mdi-github-circle"></i>
                    </a>

                  </li>-->
                  <li class="dropdown notifications-menu">
                    <!-- <button class="dropdown-toggle" data-toggle="dropdown">
                      <i class="mdi mdi-bell-outline"></i>
                    </button>-->
                    <ul class="dropdown-menu dropdown-menu-right"> 
                    
                    </ul>
                  </li> 
                  <!-- User Account -->
                  <li class="dropdown user-menu">
                    <button href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                      <img src="{% static 'img/user/user1.png' %}" class="user-image" alt="User Image" />
                      <span class="d-none d-lg-inline-block">{{ user.first_name}} {{user.last_name}} </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">    
                      <!-- User image -->
                      <li class="dropdown-header">
                        <img src="{% static 'img/user/user1.png' %}" class="img-circle" alt="User Image" />
                        <div class="d-inline-block">
                          {{ user.first_name}} {{user.last_name}} <small class="pt-1">{{ user.email }}</small>
                        </div>
                      </li>

                      <li>
                        <a href="../about">
                          <i class="mdi mdi-account"></i> My Profile
                        </a>
                      </li>
                      <li class="dropdown-footer">
                        <a href="logout/"> <i class="mdi mdi-logout"></i> Log Out </a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </nav>
          </header>

<!-- Top Statistics -->
        <!-- <div class="content-wrapper">
          <div class="content">            
                {% block content %}  
           <div class="row">
              <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="widget-block rounded bg-success  d-flex">
                  <div class="widget-info align-self-center w-50">
                    <h3 id="covered" class="text-white mb-2">0</h3>
                    <p >Covered</p>
                  </div>
                  <div class="widget-chart w-50">
                    <canvas id="gline2"></canvas>
                  </div>
                </div>
              </div>
               <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="widget-block rounded bg-danger  d-flex">
                  <div class="widget-info align-self-center w-50">
                    <h3 id="excluded" class="text-white mb-2">0</h3>
                    <p>Excluded</p>
                  </div>
                  <div class="widget-chart w-50">
                    <canvas id="areaChart2"></canvas>
                  </div>
                </div>
              </div>
           
              <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="widget-block rounded bg-warning  d-flex">
                  <div class="widget-info align-self-center w-50">
                    <h3 id="neutral" class="text-white mb-2">0</h3>
                    <p>Neutral</p>
                  </div>
                  <div class="widget-chart w-50">
                    <canvas id="linechart2"></canvas>
                  </div>
                </div>
              </div>
                 <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="widget-block rounded bg-notfound  d-flex">
                  <div class="widget-info align-self-center w-50">
                    <h3 id="not_found" class="text-white mb-2">0</h3>
                    <p style="color:white;">Nichts gefunden</p>
                  </div>
                  <div class="widget-chart w-50">
                    <canvas id="linechart1"></canvas>
                  </div>
                </div>
              </div>
          </div> -->


            <div class="row">
              <div class="col-xl-12 col-md-12">
                      <!-- Sales Graph -->
                      <div class="card card-default" data-scroll-height="675">
                        <div class="card-header">
                          <h2>Upload pdf file</h2>
                        </div>
                        <div class="card-body">
                         <div class="zone">
                            <div id="dropZ">
                              <i class="fa fa-cloud-upload"></i>
                              <div>Upload</div>
                              <span></span>
                                <div class="selectFile">   
                                 <form method="Post" enctype="multipart/form-data" id="formupl">
                                  {% csrf_token %}
                                   {{ form }}
                                  </form>
                                </div>
                            </div>
                          </div>
                        </div>
                        <div id="progress-file" class="progress mb-3 mt-3 d-none" style="margin-left: 50px; margin-right: 50px;">
                          <div id="progressbar-file" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"></div>
                        </div>
                        <div class="card-footer d-flex flex-wrap bg-white p-0">
                          <div class="col-12 px-0">
                            <div class="text-center p-4">
                              <button type="button" class="mb-1 btn btn-square btn-block btn-primary" style="color: black; background-color: #ebeff2;border-color:  #6c757d ;" data-toggle="modal" data-target="#exampleModalLong">
                             Show result
                          </button>
                            </div>
                          </div>
                          <!-- <div class="col-6 px-0">
                            <div id="download_results_link" class="text-center p-4 border-left">
                            <a href="http://127.0.0.1:8000/Results/?download=1&docid={{ doc_id }}&docname={{ doc_name }} " id="downloadResults" target="_blank" style="text-decoration: none;color: black ;" > <div id="button" class="mb-1 btn btn-square btn-block btn-primary" style="color: black; background-color: #ebeff2;border-color:  #6c757d ;" >Download</div></a>
                            </div>
                          </div> -->
                        </div>
                      </div>
                </div>

            </div>

      <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog"  
             aria-labelledby="exampleModalLongTitle" aria-hidden="true" >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">{{ doc_name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    
                  </div>
                  <div class="modal-body">
                  <table id="tresults">
                    <!-- <tr> -->
                      <!-- <th>Kategorie</th> -->
                      <!-- DP -->
                      <!-- QITU DONART -->
                      <!-- <th>Result</th> -->
                    <!-- </tr> -->
                  
                    <tr>
                    
                    </tr>
                  </table>
                  <p id="exampleModalLongAmswer" style="font-size: 32px; margin-left: 30px; margin-right: auto;">{{ doc_result_text }}</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-pill" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            {% endblock %}
         </div>
        </div>
<!-- ToDo CSS TO BE CHANGED AND TAKE IT TO THE OTHER SITE -->
          <div class="footer mt-auto" >
            <div class="copyright bg-white">
              <p>
                &copy; <span id="copy-year">2019</span> Copyright DP
              </p>
            </div>
            <script>
                var d = new Date();
                var year = d.getFullYear();
                document.getElementById("copy-year").innerHTML = year;
            </script>
          </div>

    </div>
  </div>
  <script>
    window.addEventListener('load', function () {
        var form = $('#formupl');
        var progress = $('#progress-file');
        var progressbar = $('#progressbar-file');
        form.unbind('change');
      $(document).on('change','#formupl',function(e){
        e.preventDefault();
        $form = $(this);
        var formData = new FormData(this);
        progress.removeClass('d-none');
        progressbar.css('width', '0%');
        progressbar.removeClass('bg-success');
        progressbar.addClass('progress-bar-animated');
        window.onbeforeunload=function(e){
          return "closing";
        }
        $.ajax({
            url: window.location.pathname,
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
             xhr: function () {
                    var myXhr = $.ajaxSettings.xhr();
                    if (myXhr.upload) {
                        myXhr.upload.addEventListener('progress', function (e) {
                            if (e.lengthComputable) {
                                progressbar.css('width', 100 * e.loaded / e.total + '%');
                            }
                        }, false);
                    }
                    return myXhr;
                },
             success: function (response) {
                  if(response.error){
                    window.onbeforeunload=function(e){}
                    toastr.error('Error');
                   
                  }
                  else{
                    window.onbeforeunload=function(e){}
                       toastr.success(response.message);
                       var ja=0;
                       var nein=0;
                       var not_found=0;
                       var zero=0;
                        $("#tresults").empty();
                        $("#tresults").append("<tr><th>Result</th></tr>")
                       for (i in response.results) {
                          var category_name=response.results[i][0];
                          var category_result=response.results[i][1]
                          var category_price=response.results[i][3]
                          if(category_result == "Ja" && category_price!=0.00){
                            $("#tresults").append("<tr><td>"+category_name+"</td><td class='cellJa'><p>Ja, mitversichert, "+category_price+" &euro; </p></td></tr>");
                            ja+=1;
                          }
                          else if(category_result == "Ja" && category_price==0.00){
                            $("#tresults").append("<tr><td>"+category_name+"</td><td class='cellJa'><p>Ja, mitversichert</p></td></tr>");
                            ja+=1;
                          }
                          else if(category_result == "Nein"){
                            $("#tresults").append("<tr><td>"+category_name+"</td><td class='cellNein'><p>Nein, nicht mitversichert</p></td></tr>");
                            nein+=1;
                          }
                          else if(category_result == "Zero"){
                            $("#tresults").append("<tr><td>"+category_name+"</td><td class='cellZero'><p>Neutral, nicht spezifiziert</p></td></tr>");
                            zero+=1;
                          }
                          else{
                            $("#tresults").append("<tr><td>"+category_name+"</td><td class='cellNotFound'><p>Nichts gefunden</p></td></tr>");
                            not_found+=1;
                          }
                        }
                       progressbar.addClass('bg-success');
                       progressbar.removeClass('progress-bar-animated');
                       progressbar.css('width', '100%');
                      var document_name=response.doc_name;
                      var document_id=response.doc_id;
                      var document_answer=response.doc_result_text;
                       $('#downloadResults').attr("href","http://127.0.0.1:8000/Results/?download=1&docid="+ document_id + "&docname="+ document_name +"");
                       $('#exampleModalLongTitle').text(document_name);
                       $('#exampleModalLongAmswer').text(document_answer);

                       $('#covered').html(ja);
                       $('#excluded').html(nein);
                       $('#neutral').html(zero);
                       $('#not_found').html(not_found);
                  }
               }
           });
       });
   });
  </script>

    
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCn8TFXGg17HAUcNpkwtxxyT9Io9B_NcM" defer></script>
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'plugins/toaster/toastr.min.js' %}"></script>
<script src="{% static 'plugins/slimscrollbar/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'plugins/charts/Chart.min.js' %}"></script>
<script src="{% static 'plugins/ladda/spin.min.js' %}"></script>
<script src="{% static 'plugins/ladda/ladda.min.js' %}"></script>
<script src="{% static 'plugins/jquery-mask-input/jquery.mask.min.js' %}"></script>
<script src="{% static 'plugins/select2/js/select2.min.js' %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-2.0.3.min.js' %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-world-mill.js' %}"></script>
<script src="{% static 'plugins/daterangepicker/moment.min.js' %}"></script>
<script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'plugins/jekyll-search.min.js' %}"></script>
<script src="{% static 'js/sleek.js' %}"></script>
<script src="{% static 'js/chart.js' %}"></script>
<script src="{% static 'js/date-range.js' %}"></script>
<script src="{% static 'js/map.js' %}"></script>
<script src="{% static 'js/custom.js' %}"></script>
<script src="{% static 'js/script.js' %}"></script>
  </body>
</html>
